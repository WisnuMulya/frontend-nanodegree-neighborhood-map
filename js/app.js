"use strict";function initializeApp(){if(!localStorage.locations||JSON.parse(localStorage.locations).length<16){createLocalStorage();setTimeout(initializeFunctionalities,500)}else{initializeFunctionalities()}}function createLocalStorage(){localStorage.locations="[]";var localStorageObject;var places=[{name:"Satriamandala Museum",type:"landmark"},{name:"Taman Suropati",type:"park"},{name:"Taman Menteng",type:"park"},{name:"Gelora Bung Karno",type:"landmark"},{name:"Monumen Nasional",type:"landmark"},{name:"Ragunan Zoo",type:"zoo"},{name:"Taman Mini Indonesia Indah",type:"theme-park"},{name:"Kuningan City Mall",type:"mall"},{name:"Mall of Indonesia",type:"mall"},{name:"Pondok Indah Mall",type:"mall"},{name:"Plaza Senayan",type:"mall"},{name:"Plaza Indonesia Mall",type:"mall"},{name:"Grand Indonesia Mall",type:"mall"},{name:"Dunia Fantasi",type:"theme-park"},{name:"Taman Safari",type:"zoo"},{name:"Taman Honda Tebet",type:"park"}];places.forEach(function(place){$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?key=AIzaSyC4SBS-k9EzqVIQS67qjljL-Q5wlzftYY4&address="+place.name,function(data){place.position=data.results[0].geometry.location;localStorageObject=JSON.parse(localStorage.locations);localStorageObject.push(place);localStorage.locations=JSON.stringify(localStorageObject)}).error(function(){console.log("error")})})}function initializeFunctionalities(){var jakarta={name:"jakarta",position:{lat:-6.2087634,lng:106.845599}};var map=new google.maps.Map(document.getElementById("map"),{center:jakarta.position,zoom:10});var infowindowElem='<div id="infowindow-content" data-bind="with: infowindowContent">';infowindowElem+='<h1 data-bind="text: title"></h1>';infowindowElem+="<h2>Wikipedia Description:</h2>";infowindowElem+='<p data-bind="text: wikiDesc"></p>';infowindowElem+="<h2>Flickr Images:</h2>";infowindowElem+='<div data-bind="html: flickrImg"></div></div>';var infowindow=new google.maps.InfoWindow({content:infowindowElem,maxWidth:400});var infowindowOpen=function(spotObject,vm){spotObject.marker.setAnimation(google.maps.Animation.BOUNCE);setTimeout(function(){spotObject.marker.setAnimation(null)},1500);var flickrStrings="";map.panTo(spotObject.marker.getPosition());infowindow.open(map,spotObject.marker);vm.selectedSpot(spotObject);vm.infowindowTitle(spotObject.name);var wikiUrl="http://en.wikipedia.org/w/api.php?action=opensearch&search="+spotObject.name+" &format=json&callback=wikiCallBack";$.ajax({url:wikiUrl,dataType:"jsonp",success:function(data){if(data[2].length>0&&data[2][0]!==""){vm.infowindowWikiDesc(data[2][0])}else{vm.infowindowWikiDesc("Wikipedia does not have any description about this spot.")}}}).error(function(){vm.infowindowWikiDesc("There is an error on fetching Wikipedia info.")});$.getJSON("https://api.flickr.com/services/feeds/photos_public.gne?jsoncallback=?",{format:"json",tags:spotObject.name},function(data){if(data.items.length>0){data.items.forEach(function(photo){flickrStrings=flickrStrings+'<a class="flick-img-container" target="_blank" href="'+photo.link+'"><img class="flickr-img" src="'+photo.media.m+'"></a>'});vm.infowindowFlickr(flickrStrings)}else{vm.infowindowFlickr("Flickr does not have images of this spot.")}}).error(function(){vm.infowindowFlickr("<p>There is something wrong; Flickr could not be loaded</p>")})};var Spot=function(spotObject,vm){this.name=spotObject.name;this.position=spotObject.position;this.type=spotObject.type;var icon={landmark:"flag_maps.png",park:"parks_maps.png",mall:"shopping_maps.png",zoo:"horsebackriding_maps.png","theme-park":"arts_maps.png"};this.marker=new google.maps.Marker({position:this.position,map:null,title:this.name,icon:"https://maps.google.com/mapfiles/kml/shapes/"+icon[this.type],animation:google.maps.Animation.DROP});this.marker.addListener("click",function(spot,vmCopy){return function(){infowindowOpen(spot,vmCopy)}}(this,vm))};var viewModel=function(){var self=this;self.query=ko.observable("");self.selectedSpot=ko.observable(null);self.filter=ko.observable("all");self.menuClass=ko.observable("hidden");self.infowindowTitle=ko.observable("Loading...");self.infowindowFlickr=ko.observable("Loading...");self.infowindowWikiDesc=ko.observable("Loading...");self.infowindowContent=ko.computed(function(){return{title:self.infowindowTitle(),wikiDesc:self.infowindowWikiDesc(),flickrImg:self.infowindowFlickr()}});self.jakartaSpots=ko.computed(function(){var localStorageCopy=JSON.parse(localStorage.locations);var array=[];localStorageCopy.forEach(function(spot){array.push(new Spot(spot,self))});return array});self.spots=ko.computed(function(){var search=this.query().toLowerCase();var array=this.filter()==="all"?ko.utils.arrayFilter(this.jakartaSpots(),function(spot){return spot.name.toLowerCase().indexOf(search)>=0}):ko.utils.arrayFilter(this.jakartaSpots(),function(spot){return spot.name.toLowerCase().indexOf(search)>=0&&spot.type===self.filter()});this.jakartaSpots().forEach(function(spot){spot.marker.setMap(null)});array.forEach(function(spot){spot.marker.setMap(map)});return array},self);self.infowindowOpen=function(spotObj){infowindowOpen(spotObj,self)};self.toggleMenu=function(){self.menuClass(self.menuClass()===""?"hidden":"")};google.maps.event.addListener(infowindow,"closeclick",function(){self.selectedSpot(null)})};var vmObject=new viewModel;var ifInfowindowLoaded=false;google.maps.event.addListener(infowindow,"domready",function(){if(!ifInfowindowLoaded){ko.applyBindings(vmObject,document.getElementById("infowindow-content"));ifInfowindowLoaded=true}});ko.applyBindings(vmObject)}